services:
#    core.example:
#        class: CoreBundle\Example
#        arguments: ["@service_id", "plain_value", "%parameter%"]


    #GENERIC SERVICES
    startsymfony.core.email:
        class: CoreBundle\Service\EmailService
        arguments:
            - '@twig'
            - '@mailer'
            - '%from_email%'

    #USER SERVICES
    startsymfony.core.user_service:
        class: CoreBundle\Service\User\UserService
        arguments:
            - '@doctrine.orm.default_entity_manager'
            - '@security.encoder_factory'

    startsymfony.core.forget_password:
        class: CoreBundle\Service\User\ForgetPasswordService
        arguments:
            - '@startsymfony.core.user_service'
            - '@startsymfony.core.email'

    startsymfony.core.register_service:
        class: CoreBundle\Service\User\RegisterService
        arguments:
            - '@startsymfony.core.user_service'
            - '@startsymfony.core.email'


    #AMAZON SERVICES
    startsymfony.core.s3_service:
        class: CoreBundle\Service\S3Service
        arguments:
            - '@startsymfony.core.s3client_factory'
            - '%aws_s3_bucket_name%'
            - '%kernel.environment%'


    #REPOSITORIES
    startsymfony.core.repository.user_repository:
        class: CoreBundle\Repository\UserRepository
        factory: ['@doctrine.orm.default_entity_manager', getRepository]
        arguments:
            - CoreBundle\Entity\User


    #DATA TRANSFORMER
    startsymfony.core.email_to_user_transformer:
        class: CoreBundle\Form\DataTransformer\UserEmailTransformer
        arguments:
            - '@startsymfony.core.repository.user_repository'

    #FORM
    startsymfony.core.forget_password_form:
        class: CoreBundle\Form\User\ForgetPasswordType
        arguments:
            - '@startsymfony.core.email_to_user_transformer'
        tags:
            - { name: form.type, alias: CoreBundle\Form\User\ForgetPasswordUserType }

    startsymfony.core.change_password_form:
        class: CoreBundle\Form\User\ChangePasswordType
        arguments:
            - '@security.authorization_checker'
        tags:
            - { name: form.type, alias: CoreBundle\Form\User\ForgetPasswordUserType }

    #FACTORIES
    startsymfony.core.s3client_factory:
        class: CoreBundle\Factory\S3ClientFactory
        arguments:
            - '%aws_region%'
            - '%aws_api_version%'

    startsymfony.core.facebook_client_factory:
        class: CoreBundle\Factory\FaceBookClientFactory
        arguments:
            - '%facebook_app_id%'
            - '%facebook_app_secret%'
            - '%facebook_api_version%'

    startsymfony.core.google_client_factory:
        class: CoreBundle\Factory\GoogleClientFactory
        arguments:
            - '%google_client_id%'

    startsymfony.core.social_user_provider_factory:
        class: CoreBundle\Factory\SocialUserProviderFactory
        arguments:
            - '@service_container'

    #GUARDS

    startsymfony.core.security.session_social_guard:
        class: CoreBundle\Security\Guard\SessionSocialGuard
        arguments:
            - '@startsymfony.core.social_user_provider_factory'
            - '@security.authentication.guard_handler'


    #SECURITY PROVIDERS
    startsymfony.core.security.facebook_provider:
        class: CoreBundle\Security\Provider\FacebookProvider
        arguments:
            - '@startsymfony.core.facebook_client_factory'
            - '@startsymfony.core.repository.user_repository'
            - '@startsymfony.core.register_service'


    startsymfony.core.security.google_provider:
        class: CoreBundle\Security\Provider\GoogleProvider
        arguments:
            - '@startsymfony.core.repository.user_repository'
            - '@startsymfony.core.register_service'
            - '@startsymfony.core.google_client_factory'
